<!DOCTYPE html>
<html lang="en">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

  </head>
  <body>

    </div>


    <canvas id="grayscale" width="50" height="50"></canvas>


    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.6.1"></script>
    <!--<script src="https://unpkg.com/keras-js"></script>-->
    <script src="./keras.min.js"></script>
    <script src="./js/utils.js"></script>
    <script src="./numjs.min.js"></script>

    <script>

    const model = new KerasJS.Model({
      filepath: './fuck_model.bin',
      gpu: false
    });

    var a = [[141., 113.,  97., 143., 113., 145., 126., 142.,  94.,   1.,   1.,
          1.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 114.],
       [113.,  97., 143., 113., 145., 126., 142.,  94.,   1.,   1., 114.,
          1.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 141.],
       [ 97., 143., 113., 145., 126., 142.,  94.,   1.,   1.,   1., 141.,
        114.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 113.],
       [143., 113., 145., 126., 142.,  94.,   1.,   1.,   1.,   1., 113.,
        141., 114.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,  97.],
       [113., 145., 126., 142.,  94.,   1.,   1.,   1.,   1.,   1.,  97.,
        113., 141., 114.,   1.,   1.,   1.,   1.,   1.,   1., 143.],
       [145., 126., 142.,  94.,   1.,   1.,   1.,   1.,   1.,   1., 143.,
         97., 113., 141., 114.,   1.,   1.,   1.,   1.,   1., 113.],
       [126., 142.,  94.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 113.,
        143.,  97., 113., 141., 114.,   1.,   1.,   1.,   1., 145.],
       [142.,  94.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 145.,
        113., 143.,  97., 113., 141., 114.,   1.,   1.,   1., 126.],
       [ 94.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 126.,
        145., 113., 143.,  97., 113., 141., 114.,   1.,   1., 142.],
       [  1.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1.,   1., 142.,
        126., 145., 113., 143.,  97., 113., 141., 114.,   1.,  94.]];

    var b = [[ 4.,  1.,  1., 10.,  1., 10.,  1., 10.,  1.,  5.,  5.,  5.,  5.,
         5.,  5.,  5.,  5.,  5.,  5.,  5.,  1.],
       [ 1.,  1., 10.,  1., 10.,  1., 10.,  1.,  5.,  5.,  1.,  5.,  5.,
         5.,  5.,  5.,  5.,  5.,  5.,  5.,  4.],
       [ 1., 10.,  1., 10.,  1., 10.,  1.,  5.,  5.,  5.,  4.,  1.,  5.,
         5.,  5.,  5.,  5.,  5.,  5.,  5.,  1.],
       [10.,  1., 10.,  1., 10.,  1.,  5.,  5.,  5.,  5.,  1.,  4.,  1.,
         5.,  5.,  5.,  5.,  5.,  5.,  5.,  1.],
       [ 1., 10.,  1., 10.,  1.,  5.,  5.,  5.,  5.,  5.,  1.,  1.,  4.,
         1.,  5.,  5.,  5.,  5.,  5.,  5., 10.],
       [10.,  1., 10.,  1.,  5.,  5.,  5.,  5.,  5.,  5., 10.,  1.,  1.,
         4.,  1.,  5.,  5.,  5.,  5.,  5.,  1.],
       [ 1., 10.,  1.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  1., 10.,  1.,
         1.,  4.,  1.,  5.,  5.,  5.,  5., 10.],
       [10.,  1.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5., 10.,  1., 10.,
         1.,  1.,  4.,  1.,  5.,  5.,  5.,  1.],
       [ 1.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  1., 10.,  1.,
        10.,  1.,  1.,  4.,  1.,  5.,  5., 10.],
       [ 5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5., 10.,  1., 10.,
         1., 10.,  1.,  1.,  4.,  1.,  5.,  1.]];

    model.ready()
        .then(() => {

          var input_1 = [];
          for (var i = 0; i < 10; i++) {
            input_1.push(new Float32Array(a[i]));
          }

          var input_2 = [];
          for (var i = 0; i < 10; i++) {
            input_2.push(new Float32Array(b[i]));
          }


          console.log("model ready");
          var input = gen_input('ตัดคำดีมาก');

          var batch = [];
          (async () => {
            for (var i = 0; i < 10; i++) {
              //https://github.com/transcranial/keras-js/issues/27#issuecomment-260856925
              var inputData = {"input_1": input_1[i], "input_2": input_2[i]};
              var output = await model.predict(inputData);
              //console.log(output);
              console.log("\nRESULT "+ i +": " + output.dense_2);

            }
          })();




        })
        .catch(err => {
          console.log(err);

          // handle error
        });



/*
    init = async () => {
         model = await tf.loadModel("./web_model/model.json");
         console.log("Model Loaded")
         $('#loading').hide();
         $('#btn_predict').show();
         result = model.predict(tf.zeros([1, 28, 28, 1])).print();;
       };
       init();
*/

    </script>

  </body>
</html>
